<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Favorites | Crypto Tracker</title>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQMe4N46ClhPL2V9OLdH6Z7WbyAfPTrJE",
  authDomain: "the-crypto-tracker.firebaseapp.com",
  projectId: "the-crypto-tracker",
  storageBucket: "the-crypto-tracker.appspot.com",
  messagingSenderId: "588729139716",
  appId: "1:588729139716:web:cb1dd8b5965dc019e76b51"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "index.html";
});

window.logout = async () => {
  await signOut(auth);
  window.location.href = "index.html";
};
</script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{background:linear-gradient(135deg,#000428,#004e92);color:#fff;min-height:100vh;overflow-x:hidden;}
.glow,.glow2{position:absolute;width:500px;height:500px;border-radius:50%;filter:blur(120px);animation:float 10s ease-in-out infinite alternate; z-index:-1;}
.glow{background:radial-gradient(circle, rgba(0,204,255,0.5), transparent 70%); top:-150px; left:-150px;}
.glow2{background:radial-gradient(circle, rgba(255,0,200,0.4), transparent 70%); bottom:-100px; right:-100px; animation:float2 12s ease-in-out infinite alternate;}
@keyframes float{from{transform:translate(-150px,-100px);}to{transform:translate(-50px,0px);} }
@keyframes float2{from{transform:translate(50px,70px);}to{transform:translate(0px,-50px);} }

header, footer {backdrop-filter:blur(20px); background:rgba(255,255,255,0.05); padding:15px 20px; display:flex; justify-content:space-between; align-items:center; border-radius:15px; margin:10px;}
header nav a{color:#00C9FF; text-decoration:none; margin-right:15px; transition:0.3s;}
header nav a:hover{color:#92FE9D;}
#logout-btn{padding:8px 15px; border:none; border-radius:12px; cursor:pointer; background:linear-gradient(135deg,#ff4d6d,#ff8c00);color:#fff; box-shadow:0 4px 15px rgba(255,0,100,0.4); transition:0.3s;}
#logout-btn:hover{transform:scale(1.05); box-shadow:0 6px 20px rgba(255,0,100,0.6);}

main.container{padding:20px;}
.card{backdrop-filter:blur(20px); background:rgba(255,255,255,0.05); border-radius:20px; padding:20px;margin-bottom:20px; box-shadow:0 8px 32px rgba(0,0,0,0.2); transition:0.3s;}
.card:hover{transform:translateY(-5px);}
.view-toggle{cursor:pointer; padding:8px; border-radius:12px; border:none; background:rgba(255,255,255,0.1); transition:0.3s;}
.view-toggle:hover{background:rgba(255,255,255,0.2);}
#coin-table{width:100%; border-collapse:collapse;}
#coin-table th,#coin-table td{padding:12px; border-radius:12px; text-align:left; transition:0.3s;}
#coin-table th{background:rgba(255,255,255,0.05);}
#coin-table tbody tr:hover{background:rgba(0,200,255,0.1); cursor:pointer;}
.grid-view-container{display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin-top:15px;}
.grid-card{backdrop-filter:blur(20px); background:rgba(255,255,255,0.05); border-radius:20px; padding:15px; box-shadow:0 8px 32px rgba(0,0,0,0.2); text-align:center; transition:0.3s; display:flex; flex-direction:column; align-items:center; cursor:pointer;}
.grid-card img{width:50px; height:50px; margin-bottom:10px;}
.grid-card:hover{transform:translateY(-5px);}
.price-up:hover, .grid-card.price-up:hover{border: 2px solid #2ecc71;}
.price-down:hover, .grid-card.price-down:hover{border: 2px solid #e74c3c;}
.star{cursor:pointer; font-size:20px; transition:0.3s;}
.star.favorited{color:#ffd700;}
</style>
</head>
<body>

<div class="glow"></div>
<div class="glow2"></div>

<header>
  <nav>
        <a href="home.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="portfolio.html">Portfolio</a>
        <a href="compare.html">Compare</a>
        <a href="favorites.html">Favorites</a>
        <a href="news.html">News</a>
        <a href="settings.html">Settings</a>
  </nav>
  <button id="logout-btn" onclick="logout()">Logout</button>
</header>

<main class="container">
  <h1>Your Favorite Coins</h1>

  <div class="card">
    <div style="display:flex; gap:10px; margin-bottom:15px;">
      <button class="view-toggle" id="list-view-btn">List</button>
      <button class="view-toggle" id="grid-view-btn">Grid</button>
    </div>
    <div id="coin-list-container">
      <table id="coin-table">
        <thead>
          <tr>
            <th>Fav</th><th>#</th><th>Coin</th><th>Price</th><th>24h Change</th><th>Market Cap</th><th>Volume</th>
          </tr>
        </thead>
        <tbody id="coin-list">
          <tr><td colspan="7">Loading favorites...</td></tr>
        </tbody>
      </table>
    </div>
    <div id="grid-container" class="grid-view-container" style="display:none;"></div>
  </div>
</main>

<footer>&copy; 2025 Crypto Tracker</footer>

<script>
let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
let viewMode = "list";
let favoriteCoins = [];

const coinListEl = document.getElementById("coin-list");
const gridContainer = document.getElementById("grid-container");

function saveFavorites() {
  localStorage.setItem('favorites', JSON.stringify([...favorites]));
}

function toggleFavorite(coinId) {
  if (favorites.has(coinId)) {
    favorites.delete(coinId);
  } else {
    favorites.add(coinId);
  }
  saveFavorites();
  renderFavorites();
}

async function fetchFavorites() {
  if (favorites.size === 0) {
    coinListEl.innerHTML = "<tr><td colspan='7'>No favorites yet. Go to Dashboard to add some!</td></tr>";
    return;
  }
  try {
    const ids = [...favorites].join(',');
    const res = await fetch(
      `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&price_change_percentage=24h`
    );
    favoriteCoins = await res.json();
    renderFavorites();
  } catch (e) {
    coinListEl.innerHTML = "<tr><td colspan='7'>Failed to load favorites</td></tr>";
  }
}

function renderFavorites() {
  if (favorites.size === 0) {
    coinListEl.innerHTML = "<tr><td colspan='7'>No favorites yet. Go to Dashboard to add some!</td></tr>";
    gridContainer.innerHTML = "";
    return;
  }

  if(viewMode==="list"){
    coinListEl.innerHTML="";
    favoriteCoins.forEach((c,i)=>{
      const change = c.price_change_percentage_24h;
      const isFav = favorites.has(c.id);
      const row = document.createElement("tr");
      row.className = change>=0?"price-up":"price-down";
      row.innerHTML=`
        <td><span class="star ${isFav ? 'favorited' : ''}" data-coin-id="${c.id}">${isFav ? '★' : '☆'}</span></td>
        <td>${i+1}</td>
        <td>${c.name} (${c.symbol.toUpperCase()})</td>
        <td>$${c.current_price.toLocaleString()}</td>
        <td>${change?.toFixed(2)}%</td>
        <td>$${c.market_cap.toLocaleString()}</td>
        <td>$${c.total_volume.toLocaleString()}</td>
      `;
      row.addEventListener("click",(e)=>{
        if (e.target.classList.contains('star')) return;
        window.location.href=`coinDetails.html?coinId=${c.id}`;
      });
      row.querySelector('.star').addEventListener('click', () => toggleFavorite(c.id));
      coinListEl.appendChild(row);
    });
    document.getElementById("coin-table").style.display="table";
    gridContainer.style.display="none";
  }

  if(viewMode==="grid"){
    gridContainer.innerHTML="";
    favoriteCoins.forEach((c,i)=>{
      const isFav = favorites.has(c.id);
      const card = document.createElement("div");
      card.className="grid-card "+(c.price_change_percentage_24h>=0?"price-up":"price-down");
      card.innerHTML=`
        <span class="star ${isFav ? 'favorited' : ''}" data-coin-id="${c.id}" style="align-self: flex-end;">${isFav ? '★' : '☆'}</span>
        <img src="${c.image}" alt="${c.name}">
        <h3>${c.name} (${c.symbol.toUpperCase()})</h3>
        <p>Price: $${c.current_price.toLocaleString()}</p>
        <p>24h: ${c.price_change_percentage_24h?.toFixed(2)}%</p>
        <p>Market Cap: $${c.market_cap.toLocaleString()}</p>
      `;
      card.addEventListener("click",(e)=>{
        if (e.target.classList.contains('star')) return;
        window.location.href=`coinDetails.html?coinId=${c.id}`;
      });
      card.querySelector('.star').addEventListener('click', () => toggleFavorite(c.id));
      gridContainer.appendChild(card);
    });
    document.getElementById("coin-table").style.display="none";
    gridContainer.style.display="grid";
  }
}

document.getElementById("list-view-btn").onclick=()=>{ viewMode="list"; renderFavorites(); };
document.getElementById("grid-view-btn").onclick=()=>{ viewMode="grid"; renderFavorites(); };

fetchFavorites();
</script>
</body>
</html>
